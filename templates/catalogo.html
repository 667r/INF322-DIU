<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo - BiblioUSM Makeover</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        .search-card {
            transition: all 0.3s ease;
        }
        .search-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body class="font-sans bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center">
                        <img src="https://libapps.s3.amazonaws.com/sites/13565/groups/23921/banner/Direccio%CC%81n_de_Informacio%CC%81n_y_Documentacio%CC%81n_Bibliogra%CC%81fica_Institucional.png" class="h-10 mr-2" alt="Logo">
                        <span class="text-xl font-bold text-gray-800">BiblioUSM Makeover</span>
                    </a>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="text-blue-600 font-medium">Inicio</a>
                    <div class="relative group">
                        <button class="text-gray-700 hover:text-blue-600 flex items-center">
                            Tu Biblioteca <i data-feather="chevron-down" class="ml-1 w-4 h-4"></i>
                        </button>
                        <div class="absolute hidden group-hover:block bg-white shadow-lg rounded-md mt-2 py-2 w-48 z-20 before:content-[''] before:block before:absolute before:-top-2 before:left-0 before:w-full before:h-2">
                            <a href="placeholder.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Biblioteca Central</a>
                            <a href="placeholder.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Sede Vi√±a del Mar</a>
                            <a href="placeholder.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Sede Concepci√≥n</a>
                            <a href="placeholder.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Campus Vitacura</a>
                            <a href="placeholder.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Campus San Joaqu√≠n</a>
                        </div>
                    </div>
                    <a href="placeholder.html" class="text-gray-700 hover:text-blue-600">Qui√©nes somos</a>
                    <div class="relative group">
                        <button class="text-gray-700 hover:text-blue-600 flex items-center">
                            Servicios <i data-feather="chevron-down" class="ml-1 w-4 h-4"></i>
                        </button>
                        <div class="absolute hidden group-hover:block bg-white shadow-lg rounded-md mt-2 py-2 w-48 z-20 before:content-[''] before:block before:absolute before:-top-2 before:left-0 before:w-full before:h-2">
                            <a href="placeholder.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Biblioteca en L√≠nea</a>
                        </div>
                    </div>
                    <a href="placeholder.html" class="text-gray-700 hover:text-blue-600">Inclusi√≥n</a>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="menu-toggle" class="text-gray-700">
                        <i data-feather="menu"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Filters Sidebar -->
            <div class="lg:w-1/4">
                <div class="bg-white rounded-lg shadow-md p-6 sticky top-4">
                    <h2 class="text-xl font-bold mb-4">Filtros</h2>
                    
                    <!-- Library Filter -->
                    <div class="mb-6">
                        <h3 class="font-medium mb-2">Bibliotecas</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="library" value="Biblioteca Central" class="rounded text-blue-600 mr-2">
                                <span>Biblioteca Central</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="library" value="Sede Vi√±a del Mar" class="rounded text-blue-600 mr-2">
                                <span>Sede Vi√±a del Mar</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="library" value="Sede Concepci√≥n" class="rounded text-blue-600 mr-2">
                                <span>Sede Concepci√≥n</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="library" value="Campus Vitacura" class="rounded text-blue-600 mr-2">
                                <span>Campus Vitacura</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="library" value="Campus San Joaqu√≠n" class="rounded text-blue-600 mr-2">
                                <span>Campus San Joaqu√≠n</span>
                            </label>
</div>
                    </div>

                    <!-- Availability Filter -->
                    <div class="mb-6">
                        <h3 class="font-medium mb-2">Disponibilidad</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="availability" value="available" class="rounded text-blue-600 mr-2" checked>
                                <span>Disponible</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="availability" value="borrowed" class="rounded text-blue-600 mr-2" checked>
                                <span>Prestado</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="availability" value="reserved" class="rounded text-blue-600 mr-2" checked>
                                <span>Reservado</span>
                            </label>
</div>
                    </div>

                    <!-- Material Type Filter -->
                    <div class="mb-6">
                        <h3 class="font-medium mb-2">Tipo de material</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="type" value="book" class="rounded text-blue-600 mr-2" checked>
                                <span>Libros</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="type" value="magazine" class="rounded text-blue-600 mr-2">
                                <span>Revistas</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="type" value="thesis" class="rounded text-blue-600 mr-2">
                                <span>Tesis</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="type" value="audiovisual" class="rounded text-blue-600 mr-2">
                                <span>Audiovisual</span>
                            </label>
</div>
                    </div>
                    <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition apply-filters">
                        Aplicar filtros
                    </button>
</div>
            </div>

            <!-- Search Results -->
            <div class="lg:w-3/4">
                <h1 class="text-3xl font-bold text-gray-800 mb-8">Explora nuestro cat√°logo</h1>
                
                <!-- Mis Reservas Section -->
                <div id="my-reservations-section" class="mb-8 hidden">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg shadow-md p-6 border-l-4 border-blue-600">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                            <i data-feather="bookmark" class="mr-2"></i>
                            Mis Reservas
                        </h2>
                        <div id="my-reservations-list" class="space-y-3">
                            <!-- Reserved books will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Search Form -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <form id="search-form" class="flex flex-col md:flex-row gap-4">
                        <div class="flex-grow">
                            <input id="search-input" type="text" placeholder="Buscar por t√≠tulo, autor, ISBN..." 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="flex-shrink-0">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg w-full md:w-auto transition">
                                <i data-feather="search" class="inline mr-2"></i> Buscar
                            </button>
                        </div>
                    </form>
</div>

                <!-- Results List -->
                <div class="space-y-4">
                    <!-- Result Items will be populated by JavaScript -->
                    <div id="book-results"></div>

                    <!-- Book Template (hidden) -->
                    <template id="book-template">
                        <div class="bg-white rounded-lg shadow-md p-6 book-item" data-library="" data-available="" data-type="book">
                            <div class="flex flex-col md:flex-row gap-6">
                                <div class="md:w-1/6">
                                    <img src="" alt="Book Cover" class="w-full rounded book-cover">
                                </div>
                                <div class="md:w-5/6">
                                    <h3 class="text-xl font-bold text-gray-800 mb-1 book-title"></h3>
                                    <p class="text-gray-600 mb-2 book-author"></p>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                                        <div>
                                            <p class="text-sm text-gray-500">ISBN</p>
                                            <p class="text-gray-700 book-isbn"></p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">A√±o</p>
                                            <p class="text-gray-700 book-year"></p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">Editorial</p>
                                            <p class="text-gray-700 book-publisher"></p>
                                        </div>
                                    </div>
                                     <div class="flex flex-wrap gap-2 items-center justify-between">
                                        <div>
                                            <span class="px-2 py-1 text-xs rounded-full book-status"></span>
                                            <span class="text-sm text-gray-600 book-location"></span>
                                        </div>
                                        <div class="flex gap-2">
                                            <button class="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700 transition undo-btn hidden disabled:bg-gray-400 disabled:cursor-not-allowed">
                                                Deshacer
                                            </button>
                                            <button class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 transition reserve-btn disabled:bg-gray-400 disabled:cursor-not-allowed">
                                                Reservar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
</div>

                <!-- Pagination -->
                <div class="mt-8 flex justify-center">
                    <nav class="flex items-center space-x-2">
                        <button class="px-4 py-2 rounded border border-gray-300 text-gray-600 hover:bg-gray-100">Anterior</button>
                        <button class="px-4 py-2 rounded bg-blue-600 text-white">1</button>
                        <button class="px-4 py-2 rounded border border-gray-300 text-gray-600 hover:bg-gray-100">Siguiente</button>
                    </nav>
                </div>
            </div>
</div>
        </div>
    </main>
    <!-- Reservation Confirmation Modal -->
    <div id="reservation-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
      <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md p-6 animate-fadeIn">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Confirmar reserva</h2>
        <p id="reservation-message" class="text-gray-600 mb-6">
          ¬øDeseas reservar este libro?
        </p>
        <div class="flex justify-end gap-3">
          <button id="cancel-reservation-btn" 
                  class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-gray-800 font-medium">
            Cancelar
          </button>
          <button id="confirm-reservation-btn" 
                  class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium">
            Confirmar
          </button>
        </div>
      </div>
    </div>
      <!-- Confirmaci√≥n de Cancelaci√≥n -->
  <div id="cancel-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-11/12 max-w-md p-6 animate-fadeIn">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">Cancelar reserva</h2>
      <p id="cancel-message" class="text-gray-600 mb-6"></p>
      <div class="flex justify-end gap-3">
        <button id="cancel-cancel-btn"
                class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-gray-800 font-medium">Volver</button>
        <button id="confirm-cancel-btn"
                class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white font-medium">Cancelar reserva</button>
      </div>
    </div>
  </div>

    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
      }
      .animate-fadeIn {
        animation: fadeIn 0.2s ease-out;
      }
    </style>

    <!-- Reuse existing footer -->
<footer class="bg-gray-900 text-white pt-12 pb-6">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">BiblioUSM Makeover</h3>
                    <p class="mb-4">Tu portal de acceso a recursos acad√©micos y servicios bibliotecarios de primer nivel.</p>
                    <div class="flex space-x-4">
                        <a href="#" class="hover:text-blue-400 transition"><i data-feather="instagram"></i></a>
                        <a href="#" class="hover:text-blue-400 transition"><i data-feather="facebook"></i></a>
                        <a href="#" class="hover:text-blue-400 transition"><i data-feather="twitter"></i></a>
                        <a href="#" class="hover:text-blue-400 transition"><i data-feather="youtube"></i></a>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Enlaces r√°pidos</h3>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="hover:text-blue-400 transition">Inicio</a></li>
                        <li><a href="catalogo.html" class="hover:text-blue-400 transition">Cat√°logo</a></li>
                        <li><a href="placeholder.html" class="hover:text-blue-400 transition">Biblioteca en l√≠nea</a></li>
                        <li><a href="placeholder.html" class="hover:text-blue-400 transition">Contacto</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Sedes</h3>
                    <ul class="space-y-2">
                        <li><a href="placeholder.html" class="hover:text-blue-400 transition">Casa Central</a></li>
                        <li><a href="placeholder.html" class="hover:text-blue-400 transition">Vi√±a del Mar</a></li>
                        <li><a href="placeholder.html" class="hover:text-blue-400 transition">Concepci√≥n</a></li>
                        <li><a href="placeholder.html" class="hover:text-blue-400 transition">Vitacura</a></li>
                        <li><a href="placeholder.html" class="hover:text-blue-400 transition">San Joaqu√≠n</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Contacto</h3>
                    <p class="mb-2"><i data-feather="mail" class="inline mr-2 w-4 h-4"></i> biblioteca@usm.cl</p>
                    <p class="mb-2"><i data-feather="phone" class="inline mr-2 w-4 h-4"></i> +56 32 2654 321</p>
                    <p><i data-feather="map-pin" class="inline mr-2 w-4 h-4"></i> Avenida Espa√±a 1680, Valpara√≠so</p>
                </div>
            </div>
            <div class="border-t border-gray-800 pt-6 text-center text-gray-400">
                <p>¬© 2025 DIUpibes Inc. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>
    <script>
        // Load book reservations from localStorage
        let bookReservations = JSON.parse(localStorage.getItem('bookReservations') || '{}');
        
        // Book data
        const books = [
            {
                title: "Cien a√±os de soledad",
                author: "Gabriel Garc√≠a M√°rquez",
                cover: "http://static.photos/education/120x180/1",
                isbn: "978-0307474728",
                year: "1967",
                publisher: "Sudamericana",
                status: "available",
                libraries: ["Biblioteca Central", "Campus San Joaqu√≠n"],
                type: "book",
                dueDate: "",
                description: "Una novela que narra la historia de la familia Buend√≠a a lo largo de siete generaciones en el pueblo ficticio de Macondo."
            },
            {
                title: "Rayuela",
                author: "Julio Cort√°zar",
                cover: "http://static.photos/education/120x180/2",
                isbn: "978-8437604571",
                year: "1963",
                publisher: "Alfaguara",
                status: "borrowed",
                libraries: ["Sede Vi√±a del Mar"],
                type: "book",
                dueDate: "15/12/2023",
                description: "Novela innovadora que puede leerse de manera lineal o siguiendo un orden alternativo propuesto por el autor."
            },
            {
                title: "Ficciones",
                author: "Jorge Luis Borges",
                cover: "http://static.photos/education/120x180/3",
                isbn: "978-8420674232",
                year: "1944",
                publisher: "Emec√©",
                status: "reserved",
                libraries: ["Campus Vitacura"],
                type: "book",
                dueDate: "20/12/2023",
                description: "Colecci√≥n de cuentos que exploran temas como la naturaleza del tiempo, el infinito y los universos paralelos."
            },
            {
                title: "La ciudad y los perros",
                author: "Mario Vargas Llosa",
                cover: "http://static.photos/education/120x180/4",
                isbn: "978-8420471832",
                year: "1963",
                publisher: "Alfaguara",
                status: "available",
                libraries: ["Sede Concepci√≥n"],
                type: "book",
                dueDate: "",
                description: "Primera novela del autor que retrata la vida en un colegio militar en Lima."
            },
            {
                title: "El t√∫nel",
                author: "Ernesto S√°bato",
                cover: "http://static.photos/education/120x180/5",
                isbn: "978-8432218481",
                year: "1948",
                publisher: "Seix Barral",
                status: "available",
                libraries: ["Biblioteca Central"],
                type: "book",
                dueDate: "",
                description: "Novela psicol√≥gica que explora la obsesi√≥n y la soledad a trav√©s de la confesi√≥n de un pintor asesino."
            },
            {
                title: "Ingenier√≠a de Software: Un Enfoque Pr√°ctico",
                author: "Roger S. Pressman",
                cover: "http://static.photos/education/120x180/6",
                isbn: "978-6071503145",
                year: "2010",
                publisher: "McGraw-Hill",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "book",
                dueDate: "",
                description: "Gu√≠a completa sobre metodolog√≠as y pr√°cticas en ingenier√≠a de software moderna."
            },
            {
                title: "Estructuras de Datos en Java",
                author: "Mark Allen Weiss",
                cover: "http://static.photos/education/120x180/7",
                isbn: "978-8478290499",
                year: "2013",
                publisher: "Pearson",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "book",
                dueDate: "",
                description: "An√°lisis profundo de estructuras de datos y algoritmos con implementaciones en Java."
            },
            {
                title: "Introducci√≥n a los Sistemas Digitales",
                author: "Thomas L. Floyd",
                cover: "http://static.photos/education/120x180/8",
                isbn: "978-9702613077",
                year: "2012",
                publisher: "Pearson",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "book",
                dueDate: "",
                description: "Fundamentos de electr√≥nica digital y dise√±o de circuitos l√≥gicos."
            },
            {
                title: "F√≠sica Universitaria Vol. 1",
                author: "Sears, Zemansky",
                cover: "http://static.photos/education/120x180/9",
                isbn: "978-6073221252",
                year: "2013",
                publisher: "Pearson",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "book",
                dueDate: "",
                description: "Texto fundamental de f√≠sica para carreras de ingenier√≠a y ciencias."
            },
            {
                title: "C√°lculo Diferencial e Integral",
                author: "James Stewart",
                cover: "http://static.photos/education/120x180/10",
                isbn: "978-6074817188",
                year: "2012",
                publisher: "Cengage Learning",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "book",
                dueDate: "",
                description: "Manual completo de c√°lculo para estudiantes de ingenier√≠a."
            },
            {
                title: "Machine Learning Algorithms for Predictive Analytics",
                author: "Dr. Mar√≠a Gonz√°lez",
                cover: "http://static.photos/education/120x180/11",
                isbn: "978-1234567890",
                year: "2023",
                publisher: "IEEE",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "thesis",
                dueDate: "",
                description: "Investigaci√≥n sobre algoritmos de aprendizaje autom√°tico aplicados a an√°lisis predictivo en sistemas complejos."
            },
            {
                title: "Quantum Computing Applications in Cryptography",
                author: "Dr. Carlos Ram√≠rez",
                cover: "http://static.photos/education/120x180/12",
                isbn: "978-1234567891",
                year: "2024",
                publisher: "Nature",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "thesis",
                dueDate: "",
                description: "An√°lisis de aplicaciones de computaci√≥n cu√°ntica en sistemas criptogr√°ficos modernos."
            },
            {
                title: "Sustainable Energy Systems: A Comprehensive Review",
                author: "Dr. Ana Torres",
                cover: "http://static.photos/education/120x180/13",
                isbn: "978-1234567892",
                year: "2023",
                publisher: "Science Direct",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "thesis",
                dueDate: "",
                description: "Revisi√≥n exhaustiva de sistemas de energ√≠a sostenible y su implementaci√≥n en Chile."
            },
            {
                title: "Neural Networks for Image Recognition",
                author: "Dr. Roberto Silva",
                cover: "http://static.photos/education/120x180/14",
                isbn: "978-1234567893",
                year: "2024",
                publisher: "ACM",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "thesis",
                dueDate: "",
                description: "Desarrollo de redes neuronales optimizadas para reconocimiento de im√°genes en tiempo real."
            },
            {
                title: "Advanced Materials for Semiconductor Manufacturing",
                author: "Dr. Patricia Mu√±oz",
                cover: "http://static.photos/education/120x180/15",
                isbn: "978-1234567894",
                year: "2023",
                publisher: "Springer",
                status: "available",
                libraries: ["Campus San Joaqu√≠n"],
                type: "thesis",
                dueDate: "",
                description: "Investigaci√≥n sobre materiales avanzados para la fabricaci√≥n de semiconductores de nueva generaci√≥n."
            }
        ];
// Status classes
        const statusClasses = {
            available: "bg-green-100 text-green-800",
            borrowed: "bg-yellow-100 text-yellow-800",
            reserved: "bg-blue-100 text-blue-800"
        };

        // Status text
        const statusText = {
            available: "Disponible",
            borrowed: "Prestado",
            reserved: "Reservado"
        };

        // Render My Reservations
        function renderMyReservations() {
            const section = document.getElementById('my-reservations-section');
            const container = document.getElementById('my-reservations-list');
            
            // Get user's reserved books
            const reservedBooks = books.filter(book => bookReservations[book.isbn]);
            
            if (reservedBooks.length === 0) {
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            container.innerHTML = '';
            
            reservedBooks.forEach(book => {
                const reservationDiv = document.createElement('div');
                reservationDiv.className = 'bg-white rounded-lg p-4 flex items-center justify-between shadow hover:shadow-md transition';
                
                reservationDiv.innerHTML = `
                    <div class="flex items-center gap-4 flex-1">
                        <img src="${book.cover}" alt="${book.title}" class="w-16 h-24 object-cover rounded">
                        <div>
                            <h3 class="font-bold text-gray-800">${book.title}</h3>
                            <p class="text-sm text-gray-600">${book.author}</p>
                            <p class="text-xs text-blue-600 mt-1">${book.libraries.join(', ')}</p>
                        </div>
                    </div>
                    <button 
                        class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition text-sm cancel-btn" 
                        data-isbn="${book.isbn}">
                        Cancelar
                    </button>
                `;
                
                container.appendChild(reservationDiv);
            });

            // Delegaci√≥n de eventos para los botones de cancelar
            document.querySelectorAll('.cancel-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    const isbn = e.target.getAttribute('data-isbn');
                    const book = reservedBooks.find(b => b.isbn === isbn);

                    const modal = document.getElementById("cancel-modal");
                    const message = document.getElementById("cancel-message");
                    const confirmBtn = document.getElementById("confirm-cancel-btn");
                    const cancelBtn = document.getElementById("cancel-cancel-btn");

                    // Configurar mensaje del modal
                    message.textContent = `¬øSeguro que quieres cancelar la reserva de "${book.title}"?`;
                    modal.classList.remove("hidden");
                    modal.classList.add("flex");

                    // Handler confirmar cancelaci√≥n
                    const confirmHandler = () => {
                        book.status = 'available';
                        delete bookReservations[book.isbn];
                        localStorage.setItem('bookReservations', JSON.stringify(bookReservations));

                        modal.classList.add("hidden");
                        modal.classList.remove("flex");

                        renderBooks();
                        renderMyReservations();

                        confirmBtn.removeEventListener("click", confirmHandler);
                        cancelBtn.removeEventListener("click", cancelHandler);
                    };

                    // Handler cancelar acci√≥n
                    const cancelHandler = () => {
                        modal.classList.add("hidden");
                        modal.classList.remove("flex");

                        confirmBtn.removeEventListener("click", confirmHandler);
                        cancelBtn.removeEventListener("click", cancelHandler);
                    };

                    confirmBtn.addEventListener("click", confirmHandler);
                    cancelBtn.addEventListener("click", cancelHandler);
                });
            });

            // Add event listeners for undo buttons
            container.querySelectorAll('.undo-reservation').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const isbn = e.target.dataset.isbn;
                    const book = books.find(b => b.isbn === isbn);
                    
                    if (confirm(`¬øCancelar la reserva de "${book.title}"?`)) {
                        book.status = 'available';
                        delete bookReservations[isbn];
                        localStorage.setItem('bookReservations', JSON.stringify(bookReservations));
                        alert('‚úÖ Reserva cancelada exitosamente');
                        renderBooks();
                        renderMyReservations();
                    }
                });
            });
        }

        // Render books
        function renderBooks(filteredBooks = books) {
            const resultsContainer = document.getElementById('book-results');
            const template = document.getElementById('book-template');
            
            resultsContainer.innerHTML = '';
            
            filteredBooks.forEach(book => {
                    // üö® Evita mostrar libros reservados en lista principal
                if (book.status === 'reserved' && !bookReservations[book.isbn]) return;
                const clone = template.content.cloneNode(true);
                const item = clone.querySelector('.book-item');
                
                // Set data attributes for filtering
                item.dataset.library = book.libraries.join(',');
                item.dataset.available = book.status;
                item.dataset.type = book.type;
                
                // Fill in book data
                clone.querySelector('.book-cover').src = book.cover;
                clone.querySelector('.book-title').textContent = book.title;
                clone.querySelector('.book-author').textContent = book.author;
                clone.querySelector('.book-isbn').textContent = book.isbn;
                clone.querySelector('.book-year').textContent = book.year;
                clone.querySelector('.book-publisher').textContent = book.publisher;
                
                // Set status
                const statusEl = clone.querySelector('.book-status');
                statusEl.textContent = statusText[book.status];
                statusEl.className = `px-2 py-1 text-xs rounded-full ${statusClasses[book.status]}`;
                
                // Set location
                const locationText = book.status === 'available' ? 
                    book.libraries.join(', ') : 
                    `${book.libraries[0]} (${book.status === 'borrowed' ? 'Devuelve' : 'Disponible'}: ${book.dueDate})`;
                clone.querySelector('.book-location').textContent = locationText;
                
                // Set reserve button state
                const reserveBtn = clone.querySelector('.reserve-btn');
                const undoBtn = clone.querySelector('.undo-btn');
                
                // Check if this book was reserved by user
                const wasReserved = bookReservations[book.isbn];
                
                if (book.status !== 'available') {
                    reserveBtn.disabled = true;
                    
                    // Show undo button only for user's own reservations
                    if (wasReserved && book.status === 'reserved') {
                        const modal = document.getElementById("cancel-modal");
                        const message = document.getElementById("cancel-message");
                        const confirmBtn = document.getElementById("confirm-cancel-btn");
                        const cancelBtn = document.getElementById("cancel-cancel-btn");
                        
                        undoBtn.classList.remove('hidden');
                        undoBtn.addEventListener('click', () => {
                            // Configurar modal
                            message.textContent = `¬øSeguro que quieres cancelar la reserva de "${book.title}"?`;
                            modal.classList.remove("hidden");
                            modal.classList.add("flex");

                            // Handler confirmar cancelaci√≥n
                            const confirmHandler = () => {
                                book.status = 'available';
                                delete bookReservations[book.isbn];
                                localStorage.setItem('bookReservations', JSON.stringify(bookReservations));

                                modal.classList.add("hidden");
                                modal.classList.remove("flex");

                                renderBooks();
                                renderMyReservations();

                                // limpiar listeners
                                confirmBtn.removeEventListener("click", confirmHandler);
                                cancelBtn.removeEventListener("click", cancelHandler);
                            };

                            // Handler cancelar acci√≥n
                            const cancelHandler = () => {
                                modal.classList.add("hidden");
                                modal.classList.remove("flex");

                                confirmBtn.removeEventListener("click", confirmHandler);
                                cancelBtn.removeEventListener("click", cancelHandler);
                            };

                            confirmBtn.addEventListener("click", confirmHandler);
                            cancelBtn.addEventListener("click", cancelHandler);
                        });
                    }

                } else {
                    reserveBtn.addEventListener('click', () => {
                        // Configurar modal
                        const modal = document.getElementById("reservation-modal");
                        const message = document.getElementById("reservation-message");
                        const confirmBtn = document.getElementById("confirm-reservation-btn");
                        const cancelBtn = document.getElementById("cancel-reservation-btn");

                        message.textContent = `¬øQuieres reservar "${book.title}" de ${book.author}?`;
                        modal.classList.remove("hidden");
                        modal.classList.add("flex");

                        // Handler para confirmar
                        const confirmHandler = () => {
                            book.status = 'reserved';
                            bookReservations[book.isbn] = {
                                title: book.title,
                                timestamp: Date.now()
                            };
                            localStorage.setItem('bookReservations', JSON.stringify(bookReservations));

                            modal.classList.add("hidden");
                            modal.classList.remove("flex");

                            renderBooks();
                            renderMyReservations();

                            // limpiar event listeners
                            confirmBtn.removeEventListener("click", confirmHandler);
                            cancelBtn.removeEventListener("click", cancelHandler);
                        };

                        // Handler para cancelar
                        const cancelHandler = () => {
                            modal.classList.add("hidden");
                            modal.classList.remove("flex");
                            confirmBtn.removeEventListener("click", confirmHandler);
                            cancelBtn.removeEventListener("click", cancelHandler);
                        };

                        confirmBtn.addEventListener("click", confirmHandler);
                        cancelBtn.addEventListener("click", cancelHandler);
});
                }
                
                resultsContainer.appendChild(clone);
            });
            
            // Update My Reservations section
            renderMyReservations();
        }

        // Filter books
        function filterBooks() {
            const libraryFilters = Array.from(document.querySelectorAll('input[name="library"]:checked')).map(cb => cb.value);
            const availabilityFilters = Array.from(document.querySelectorAll('input[name="availability"]:checked')).map(cb => cb.value);
            const typeFilters = Array.from(document.querySelectorAll('input[name="type"]:checked')).map(cb => cb.value);
            
            const filtered = books.filter(book => {
                // Filter by library
                if (libraryFilters.length > 0 && !libraryFilters.some(lib => book.libraries.includes(lib))) {
                    return false;
                }
                
                // Filter by availability
                if (availabilityFilters.length > 0 && !availabilityFilters.includes(book.status)) {
                    return false;
                }
                
                // Filter by type
                if (typeFilters.length > 0 && !typeFilters.includes(book.type)) {
                    return false;
                }
                
                return true;
            });
            
            renderBooks(filtered);
        }
        // Search books
        function searchBooks(query) {
            if (!query) return books;
            
            const lowerQuery = query.toLowerCase();
            return books.filter(book => {
                return (
                    book.title.toLowerCase().includes(lowerQuery) ||
                    book.author.toLowerCase().includes(lowerQuery) ||
                    book.isbn.toLowerCase().includes(lowerQuery) ||
                    book.description.toLowerCase().includes(lowerQuery) ||
                    book.publisher.toLowerCase().includes(lowerQuery)
                );
            });
        }
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Mobile menu toggle
            document.getElementById('menu-toggle')?.addEventListener('click', function() {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });

            // Toggle filter sections on mobile
            document.querySelectorAll('#mobile-menu div.relative button').forEach(button => {
                button.addEventListener('click', function() {
                    const menu = this.nextElementSibling;
                    menu.classList.toggle('hidden');
                });
            });

            // Apply filters button
            document.querySelector('.apply-filters').addEventListener('click', filterBooks);

            // Search form submission
            document.getElementById('search-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const searchInput = document.getElementById('search-input');
                const results = searchBooks(searchInput.value.trim());
                renderBooks(results);
            });

            // Initialize Feather Icons
            feather.replace();

            // Render initial books
            renderBooks();

            // Check for search query in URL
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('q');
            if (searchQuery) {
                document.getElementById('search-input').value = searchQuery;
                const results = searchBooks(searchQuery);
                renderBooks(results);
            }
        });
</script>
</body>
</html>